"use strict";var m=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var I=(e,t)=>{for(var s in t)m(e,s,{get:t[s],enumerable:!0})},O=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of S(t))!D.call(e,c)&&c!==s&&m(e,c,{get:()=>t[c],enumerable:!(n=C(t,c))||n.enumerable});return e};var k=e=>O(m({},"__esModule",{value:!0}),e);var j={};I(j,{default:()=>v});module.exports=k(j);var r=require("@raycast/api");var g=require("@raycast/api");var p=require("@raycast/api");var{messageLimit:J}=(0,p.getPreferenceValues)(),h=parseInt(J);var d=1,y=(e,t=864e5)=>Date.now()-e>t,i=new g.Cache,L=()=>{i.clear()},M=()=>{if(i.has("accounts")){let e=i.get("accounts");if(e){let{time:t,data:s,version:n}=JSON.parse(e);if(!y(t)&&n===d)return s}}},N=e=>M()?.find(t=>t.id===e||t.name===e),P=e=>{i.set("accounts",JSON.stringify({time:Date.now(),data:e,version:d}))},u=new g.Cache,$=()=>{u.clear()},f=(e,t)=>{let s=`${e}-${t}`;if(u.has(s)){let n=u.get(s);if(n){let{time:c,data:a,version:o}=JSON.parse(n);if(!y(c)&&o===d)return a.slice(0,h)}}return[]},l=(e,t,s)=>{let n=`${t}-${s}`;u.set(n,JSON.stringify({time:Date.now(),data:e,version:d}))},V=(e,t,s)=>{let c=[...f(t,s),e];l(c,t,s)},F=(e,t,s,n)=>{let a=f(s,n).map(o=>o.id===e?{...o,...t}:o);l(a,s,n)},H=(e,t,s)=>{let c=f(t,s).filter(a=>a.id!==e);l(c,t,s)},w=new g.Cache,R=()=>{let e=M();if(!e||e.length===0)return;let t=w.get("default-account-id");if(t){let s=e.find(n=>n.id===t);if(s)return s}return e[0]},W=e=>{w.set("default-account-id",e)},A=Object.freeze({getAccounts:M,setAccounts:P,getDefaultAccount:R,setDefaultAccount:W,getAccount:N,invalidateAccounts:L,getMessages:f,setMessages:l,addMessage:V,updateMessage:F,deleteMessage:H,invalidateMessages:$});async function v(){await(0,r.closeMainWindow)(),await(0,r.showToast)(r.Toast.Style.Animated,"Clearing cache"),A.invalidateMessages(),A.invalidateAccounts(),await(0,r.showToast)(r.Toast.Style.Success,"All mails and accounts cleared from cache")}

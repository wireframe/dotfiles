"use strict";var F=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var tt=(t,e)=>{for(var n in e)F(t,n,{get:e[n],enumerable:!0})},et=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of X(e))!Z.call(t,r)&&r!==n&&F(t,r,{get:()=>e[r],enumerable:!(o=Q(e,r))||o.enumerable});return t};var nt=t=>et(F({},"__esModule",{value:!0}),t);var it={};tt(it,{default:()=>K});module.exports=nt(it);var s=require("@raycast/api"),z=require("react");var N=require("@raycast/api"),I=require("react");var S=t=>{let e=Math.floor(t/3600),n=String(Math.floor(t%3600/60)).padStart(2,"0"),o=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${n}:${o}`},L=t=>{let e=new Date(t),n=[e.getFullYear().toString(),(e.getMonth()+1).toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")],o=[e.getHours(),e.getMinutes(),e.getSeconds()].map(P=>P.toString().padStart(2,"0")),r=n.join("-"),f=o.join(":");return`${r} ${f}`},h=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var y=require("@raycast/api"),W=require("child_process"),B=require("crypto"),i=require("fs"),V=require("path");var l=require("@raycast/api");var T=t=>{let e=(0,l.getPreferenceValues)();if(t.launchedFromMenuBar||e.closeWindowOnTimerStart){let n=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,l.showHUD)(`${n} ${t.msg}`),(0,l.popToRoot)()}else(0,l.showToast)({style:t.isErr?l.Toast.Style.Failure:l.Toast.Style.Success,title:t.msg})};var c=y.environment.supportPath+"/raycast-stopwatches.json",g=()=>{(!(0,i.existsSync)(c)||(0,i.readFileSync)(c).toString()=="")&&(0,i.writeFileSync)(c,"[]")},v=t=>({name:t,swID:(0,B.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),ot=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,h({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let n=Math.max(0,h({d2:e.timeStarted}));e.timeElapsed=n-e.pauseElapsed}}),t),k=()=>{g();let t=JSON.parse((0,i.readFileSync)(c).toString()),e=st(t),n=ot(e);return n.sort((o,r)=>o.timeElapsed-r.timeElapsed),n},x=async({swName:t="Untitled",launchedFromMenuBar:e=!1})=>{g();let n=JSON.parse((0,i.readFileSync)(c).toString()),o=v(t);n.push(o),(0,i.writeFileSync)(c,JSON.stringify(n)),T({msg:`Stopwatch "${t}" started!`,launchedFromMenuBar:e,isErr:!1})},U=t=>{g();let e=JSON.parse((0,i.readFileSync)(c).toString());e=e.map(n=>n.swID==t?{...n,lastPaused:new Date}:n),(0,i.writeFileSync)(c,JSON.stringify(e))},_=t=>{g();let e=JSON.parse((0,i.readFileSync)(c).toString());e=e.map(n=>n.swID==t?{...n,pauseElapsed:n.pauseElapsed+h({d2:n.lastPaused}),lastPaused:"----"}:n),(0,i.writeFileSync)(c,JSON.stringify(e))},H=t=>{g();let e=JSON.parse((0,i.readFileSync)(c).toString());e=e.filter(n=>n.swID!==t),(0,i.writeFileSync)(c,JSON.stringify(e))},st=t=>((0,i.readdirSync)(y.environment.supportPath).forEach(n=>{if((0,V.extname)(n)==".stopwatch"){let o=v((0,i.readFileSync)(y.environment.supportPath+"/"+n).toString()),r=n.replace(/__/g,":").replace(".stopwatch","");o.timeStarted=new Date(r),o.timeElapsed=Math.max(0,h({})),(0,W.execSync)(`rm "${y.environment.supportPath}/${n}"`),t.push(o)}}),(0,i.writeFileSync)(c,JSON.stringify(t)),t),j=(t,e)=>{g();let o=JSON.parse((0,i.readFileSync)(c,"utf8")).map(r=>r.swID==t?{...r,name:e}:r);(0,i.writeFileSync)(c,JSON.stringify(o))};function b(){let[t,e]=(0,I.useState)(void 0),[n,o]=(0,I.useState)(t===void 0),r=()=>{let a=k();e(a),o(!1)},f=a=>{x(a),r()},P=a=>{U(a),r()},R=a=>{_(a),r()},C=a=>{(0,N.getPreferenceValues)().copyOnSwStop&&N.Clipboard.copy(S(a.timeElapsed)),H(a.swID),r()};return{stopwatches:t,isLoading:n,refreshSWes:r,handleRestartSW:a=>{C(a),f({swName:a.name,launchedFromMenuBar:!1}),r()},handleStartSW:f,handleStopSW:C,handlePauseSW:P,handleUnpauseSW:R}}var w=require("@raycast/api");var p=require("@raycast/api");var E=require("@raycast/api");var d=require("fs");var D=E.environment.supportPath+"/customTimers.json",Pt=E.environment.supportPath+"/defaultPresetVisibles.json";function G(t,e){let n=E.environment.supportPath+"/"+t,o=(0,d.readFileSync)(n).toString(),r=JSON.parse(o);r.name=e,(0,d.writeFileSync)(n,JSON.stringify(r))}function rt(){(0,d.existsSync)(D)||(0,d.writeFileSync)(D,JSON.stringify({}))}function Y(t,e){rt();let n=JSON.parse((0,d.readFileSync)(D,"utf8"));n[t].name=e,(0,d.writeFileSync)(D,JSON.stringify(n))}var O=require("react/jsx-runtime");function q(t){let{pop:e}=(0,p.useNavigation)(),n=o=>{if(o===""||o===t.currentName)new p.Toast({style:p.Toast.Style.Failure,title:"No new name given!"}).show();else{switch(e(),t.originalFile){case"customTimer":Y(t.ctID?t.ctID:"-99",o);break;case"stopwatch":j(t.ctID?t.ctID:"-99",o);break;default:G(t.originalFile,o);break}T({msg:`Renamed to ${o}!`,launchedFromMenuBar:!1,isErr:!1})}};return(0,O.jsx)(p.Form,{actions:(0,O.jsx)(p.ActionPanel,{children:(0,O.jsx)(p.Action.SubmitForm,{title:"Rename",onSubmit:o=>n(o.newName)})}),children:(0,O.jsx)(p.Form.TextField,{id:"newName",title:"New name",placeholder:t.currentName})})}var M=require("react/jsx-runtime");function J(t){let{push:e}=(0,w.useNavigation)();return(0,M.jsx)(w.Action,{title:`Rename ${t.renameLabel}`,icon:w.Icon.TextInput,onAction:()=>e((0,M.jsx)(q,{currentName:t.currentName,originalFile:t.originalFile,ctID:t.ctID}))})}var u=require("react/jsx-runtime");function K(){let{stopwatches:t,isLoading:e,refreshSWes:n,handleRestartSW:o,handleStartSW:r,handleStopSW:f,handlePauseSW:P,handleUnpauseSW:R}=b();(0,z.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]);let C={tag:{value:"Paused",color:s.Color.Red}},$={tag:{value:"Running",color:s.Color.Green}},a={source:s.Icon.Clock,tintColor:s.Color.Red},A={source:s.Icon.Clock,tintColor:s.Color.Green};return(0,u.jsx)(s.List,{isLoading:e,children:(0,u.jsxs)(s.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Stopwatches Running",children:[t?.map(m=>(0,u.jsx)(s.List.Item,{icon:m.lastPaused=="----"?A:a,title:m.name,subtitle:S(m.timeElapsed)+" elapsed",accessories:[{text:"Started at "+L(m.timeStarted)},m.lastPaused=="----"?$:C],actions:(0,u.jsxs)(s.ActionPanel,{children:[m.lastPaused=="----"?(0,u.jsx)(s.Action,{title:"Pause Stopwatch",icon:s.Icon.Pause,onAction:()=>P(m.swID)}):(0,u.jsx)(s.Action,{title:"Unpause Stopwatch",icon:s.Icon.Play,onAction:()=>R(m.swID)}),(0,u.jsx)(J,{renameLabel:"Stopwatch",currentName:m.name,originalFile:"stopwatch",ctID:m.swID}),(0,u.jsx)(s.Action.CopyToClipboard,{title:"Copy Current Time",shortcut:{modifiers:["cmd"],key:"c"},content:S(m.timeElapsed)}),(0,u.jsx)(s.Action,{title:"Restart Stopwatch",icon:s.Icon.ArrowCounterClockwise,shortcut:{modifiers:["cmd"],key:"r"},onAction:()=>o(m)}),(0,u.jsx)(s.Action,{title:"Stop Stopwatch",icon:s.Icon.Stop,shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>f(m)})]})},m.swID)),(0,u.jsx)(s.List.Item,{icon:s.Icon.Clock,title:"Create a new stopwatch",subtitle:"Press Enter to start a stopwatch",actions:(0,u.jsx)(s.ActionPanel,{children:(0,u.jsx)(s.Action,{title:"Start Stopwatch",icon:s.Icon.Stopwatch,onAction:()=>r({})})})},0)]})})}

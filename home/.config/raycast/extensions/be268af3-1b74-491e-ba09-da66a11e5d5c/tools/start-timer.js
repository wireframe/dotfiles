"use strict";var p=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var $=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},J=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of F(t))!D.call(e,i)&&i!==n&&p(e,i,{get:()=>t[i],enumerable:!(r=b(t,i))||r.enumerable});return e};var R=e=>J(p({},"__esModule",{value:!0}),e);var v={};$(v,{default:()=>L});module.exports=R(v);var M=require("@raycast/api");var u=require("@raycast/api"),y=require("child_process"),w=require("crypto"),o=require("fs");var h=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),r=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${n}:${r}`};var s=require("@raycast/api"),l=require("fs");var T=e=>{let t=(0,s.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let n=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,s.showHUD)(`${n} ${e.msg}`),(0,s.popToRoot)()}else(0,s.showToast)({style:e.isErr?s.Toast.Style.Failure:s.Toast.Style.Success,title:e.msg})},P=async()=>{let e=s.environment.supportPath+"/ringContinuouslyWarningShown";if(!(0,s.getPreferenceValues)().ringContinuously||(0,l.existsSync)(e))return!0;let n=await(0,s.confirmAlert)({title:"Ring Continuously is enabled!",icon:s.Icon.Bell,message:'When the timer rings, you will need to use the "Stop Running Timer" command or stop the timer in the "Manage Timers" command to dismiss the sound. You can configure this in your Raycast settings.'});return n&&(0,l.writeFileSync)(e,""),n};var d=u.environment.supportPath+"/customTimers.json",A=u.environment.supportPath+"/defaultPresetVisibles.json";async function C({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:n=!1,selectedSound:r="default",skipRingContinuouslyWarning:i=!1}){if(!i&&!await P())return;let a=(u.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__"),c=(0,u.getPreferenceValues)();if(c.ringContinuously){let m=`${a}`.replace(".timer",".dismiss");(0,o.writeFileSync)(m,".dismiss file for Timers")}let f=B(a,t,e,r),N=(0,y.exec)(f,(m,S)=>{if(m){console.log(`error: ${m.message}`);return}if(S){console.log(`stderr: ${S}`);return}}),E={name:t,pid:N.pid,lastPaused:"---",pauseElapsed:0,selectedSound:r==="default"?c.selectedSound:r};(0,o.writeFileSync)(a,JSON.stringify(E)),T({msg:`Timer "${t}" started for ${h(e)}!`,launchedFromMenuBar:n,isErr:!1})}function B(e,t,n,r){let i=(0,u.getPreferenceValues)(),g=`${u.environment.assetsPath+"/"+(r==="default"?i.selectedSound:r)}`,a=[`sleep ${n}`];a.push(`if [ -f "${e}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let c=i.selectedSound==="speak_timer_name"?`say ${t}`:`afplay "${g}" --volume ${i.volumeSetting.replace(",",".")}`;if(a.push(c),i.ringContinuously){let f=`${e}`.replace(".timer",".dismiss");a.push(`while [ -f "${f}" ]; do ${c}; done`)}return a.push(`rm "${e}"; else echo "Timer deleted"; fi`),a.join(" ; ")}function I(){(0,o.existsSync)(d)||(0,o.writeFileSync)(d,JSON.stringify({}))}function O(e){I();let t=JSON.parse((0,o.readFileSync)(d,"utf8"));t[(0,w.randomUUID)()]=e,(0,o.writeFileSync)(d,JSON.stringify(t))}async function L(e){let t=3600*Number(e.hours)+60*Number(e.minutes)+Number(e.seconds),n={timeInSeconds:t,timerName:e.name};if(C({...n,launchedFromMenuBar:!1,skipRingContinuouslyWarning:!0}),e.shouldBeSaved){let r=(0,M.getPreferenceValues)();O({name:e.name??"Untitled",timeInSeconds:t,selectedSound:r.selectedSound,showInMenuBar:!0})}return{...n,saved:e.shouldBeSaved??!1}}
